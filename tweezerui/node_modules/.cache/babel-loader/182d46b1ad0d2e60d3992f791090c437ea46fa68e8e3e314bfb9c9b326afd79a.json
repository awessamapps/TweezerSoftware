{"ast":null,"code":"var _jsxFileName = \"F:\\\\tweezerui\\\\src\\\\components\\\\CameraPreview\\\\CameraPreview.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { Modal, Button, Form } from 'react-bootstrap';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faCog } from '@fortawesome/free-solid-svg-icons';\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport { ToastContainer, toast } from 'react-toastify';\nimport 'react-toastify/dist/ReactToastify.css';\nimport { Slide } from 'react-toastify';\nimport axios from 'axios';\nimport { useCanvases } from '../../CanvasContext';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst mainServerURL = \"http://10.0.63.153:4000\";\nconst camServerURLs = {\n  1: \"http://10.0.63.153:4001\",\n  2: \"http://10.0.63.153:4002\"\n};\nfunction CameraPreview() {\n  _s();\n  const [allCameras, setAllCameras] = useState([]);\n  // const [canvasSize, setCanvasSize] = useState({ width: 0, height: 0 });\n  const canvasTrackRef = useRef(null);\n  const canvasHologramRef = useRef(null);\n  const {\n    canvasRefs,\n    imageProps,\n    drawProps\n  } = useCanvases();\n  let drawing = false;\n  const draw = event => {\n    if (!drawing) return;\n    const canvas = canvasHologramRef.current;\n    const ctx = canvas.getContext('2d');\n    const rect = canvas.getBoundingClientRect(); // get the position of the canvas\n\n    const x = event.clientX - drawProps.startX;\n    const y = event.clientY - drawProps.startY;\n    ctx.lineWidth = 5;\n    ctx.lineCap = 'round';\n    ctx.strokeStyle = 'red';\n    ctx.lineTo(x, y);\n    ctx.stroke();\n    ctx.beginPath();\n    ctx.moveTo(x, y);\n  };\n  const startDrawing = event => {\n    drawing = true;\n    draw(event);\n  };\n  const stopDrawing = () => {\n    drawing = false;\n    const canvas = canvasHologramRef.current;\n    const ctx = canvas.getContext('2d');\n    ctx.beginPath();\n  };\n  useEffect(() => {\n    const canvas = canvasHologramRef.current;\n    canvas.addEventListener('mousedown', startDrawing);\n    canvas.addEventListener('mousemove', draw);\n    canvas.addEventListener('mouseup', stopDrawing);\n    canvas.addEventListener('mouseout', stopDrawing);\n    return () => {\n      canvas.removeEventListener('mousedown', startDrawing);\n      canvas.removeEventListener('mousemove', draw);\n      canvas.removeEventListener('mouseup', stopDrawing);\n      canvas.removeEventListener('mouseout', stopDrawing);\n    };\n  }, []);\n  const [maxWidth, setMaxWidth] = useState(1000);\n  const [cameras, setCameras] = useState(() => {\n    var _storedCameras$, _storedCameras$$formV, _storedCameras$2, _storedCameras$2$form, _storedCameras$3, _storedCameras$3$form, _storedCameras$4, _storedCameras$4$form, _storedCameras$5, _storedCameras$5$form, _storedCameras$6, _storedCameras$6$form, _storedCameras$7, _storedCameras$7$form, _storedCameras$8, _storedCameras$8$form, _storedCameras$9, _storedCameras$9$form, _storedCameras$10, _storedCameras$10$for, _storedCameras$11, _storedCameras$11$for, _storedCameras$12, _storedCameras$12$for;\n    // Load initial camera state from localStorage\n    const storedCameras = JSON.parse(localStorage.getItem('cameras')) || {};\n    return {\n      1: {\n        isPreviewActive: true,\n        isStreaming: false,\n        showModalSettings: false,\n        isSwitchActive: true,\n        formValues: {\n          camId: ((_storedCameras$ = storedCameras[1]) === null || _storedCameras$ === void 0 ? void 0 : (_storedCameras$$formV = _storedCameras$.formValues) === null || _storedCameras$$formV === void 0 ? void 0 : _storedCameras$$formV.camId) || 'Select Option',\n          folderPath: ((_storedCameras$2 = storedCameras[1]) === null || _storedCameras$2 === void 0 ? void 0 : (_storedCameras$2$form = _storedCameras$2.formValues) === null || _storedCameras$2$form === void 0 ? void 0 : _storedCameras$2$form.folderPath) || 'F:/',\n          targetFPS: ((_storedCameras$3 = storedCameras[1]) === null || _storedCameras$3 === void 0 ? void 0 : (_storedCameras$3$form = _storedCameras$3.formValues) === null || _storedCameras$3$form === void 0 ? void 0 : _storedCameras$3$form.targetFPS) || '10',\n          imageFormat: ((_storedCameras$4 = storedCameras[1]) === null || _storedCameras$4 === void 0 ? void 0 : (_storedCameras$4$form = _storedCameras$4.formValues) === null || _storedCameras$4$form === void 0 ? void 0 : _storedCameras$4$form.imageFormat) || '',\n          exposureTime: ((_storedCameras$5 = storedCameras[1]) === null || _storedCameras$5 === void 0 ? void 0 : (_storedCameras$5$form = _storedCameras$5.formValues) === null || _storedCameras$5$form === void 0 ? void 0 : _storedCameras$5$form.exposureTime) || \"10.0\",\n          gain: ((_storedCameras$6 = storedCameras[1]) === null || _storedCameras$6 === void 0 ? void 0 : (_storedCameras$6$form = _storedCameras$6.formValues) === null || _storedCameras$6$form === void 0 ? void 0 : _storedCameras$6$form.gain) || \"1.0\"\n        },\n        comment: \"Select the camera ID from the dropdown list\",\n        isVirtual: false,\n        fps: 0,\n        rxSpeed: 0.0,\n        isFirstImageReceived: false,\n        canvasWidth: -1,\n        canvasHeight: -1\n      },\n      2: {\n        isPreviewActive: false,\n        isStreaming: false,\n        showModalSettings: false,\n        isSwitchActive: true,\n        formValues: {\n          camId: ((_storedCameras$7 = storedCameras[2]) === null || _storedCameras$7 === void 0 ? void 0 : (_storedCameras$7$form = _storedCameras$7.formValues) === null || _storedCameras$7$form === void 0 ? void 0 : _storedCameras$7$form.camId) || 'Select Option',\n          folderPath: ((_storedCameras$8 = storedCameras[2]) === null || _storedCameras$8 === void 0 ? void 0 : (_storedCameras$8$form = _storedCameras$8.formValues) === null || _storedCameras$8$form === void 0 ? void 0 : _storedCameras$8$form.folderPath) || 'F:/',\n          targetFPS: ((_storedCameras$9 = storedCameras[2]) === null || _storedCameras$9 === void 0 ? void 0 : (_storedCameras$9$form = _storedCameras$9.formValues) === null || _storedCameras$9$form === void 0 ? void 0 : _storedCameras$9$form.targetFPS) || '10',\n          imageFormat: ((_storedCameras$10 = storedCameras[2]) === null || _storedCameras$10 === void 0 ? void 0 : (_storedCameras$10$for = _storedCameras$10.formValues) === null || _storedCameras$10$for === void 0 ? void 0 : _storedCameras$10$for.imageFormat) || '',\n          exposureTime: ((_storedCameras$11 = storedCameras[2]) === null || _storedCameras$11 === void 0 ? void 0 : (_storedCameras$11$for = _storedCameras$11.formValues) === null || _storedCameras$11$for === void 0 ? void 0 : _storedCameras$11$for.exposureTime) || \"10.0\",\n          gain: ((_storedCameras$12 = storedCameras[2]) === null || _storedCameras$12 === void 0 ? void 0 : (_storedCameras$12$for = _storedCameras$12.formValues) === null || _storedCameras$12$for === void 0 ? void 0 : _storedCameras$12$for.gain) || \"1.0\"\n        },\n        comment: \"Select the camera ID from the dropdown list\",\n        isVirtual: false,\n        fps: 0,\n        rxSpeed: 0.0,\n        isFirstImageReceived: false,\n        canvasWidth: -1,\n        canvasHeight: -1\n      }\n    };\n  });\n  useEffect(() => {\n    localStorage.setItem('cameras', JSON.stringify(cameras));\n  }, [cameras]);\n  useEffect(() => {\n    const fetchCameraDetails = async () => {\n      if (cameras[1].showModalSettings || cameras[2].showModalSettings) {\n        try {\n          const response = await axios.get(camServerURLs[1] + \"/get_all_camera_details\");\n          throwErrorIfNotSuccess(response, null);\n          setAllCameras(response.data.data);\n        } catch (error) {\n          showToast(\"Error in fetching camera details\", \"error\");\n          showToast(error.message, \"error\");\n        }\n      }\n    };\n    fetchCameraDetails();\n  }, [cameras[1].showModalSettings, cameras[2].showModalSettings]);\n\n  // useEffect(() => {\n  //   Object.values(canvasRefs).forEach((canvasRef, cameraId) => {\n  //     if (canvasRef.current) {\n  //       setCanvasSize(prevCanvasSize => ({\n  //         ...prevCanvasSize,\n  //         [cameraId]: {\n  //           width: canvasRef.current.offsetWidth,\n  //           height: canvasRef.current.offsetHeight,\n\n  //         }\n  //       }));\n  //     }\n  //   });\n  // }, []);\n\n  const handleInputChange = (event, cameraId) => {\n    setCameras(prevCameras => ({\n      ...prevCameras,\n      [cameraId]: {\n        ...prevCameras[cameraId],\n        formValues: {\n          ...prevCameras[cameraId].formValues,\n          [event.target.name]: event.target.value\n        }\n      }\n    }));\n  };\n  useEffect(() => {\n    const canvas = canvasHologramRef.current;\n    const context = canvas.getContext('2d');\n\n    // Draw a hollow circle at x =100, y = 50\n    context.beginPath();\n    context.arc(150, 50, 20, 0, 2 * Math.PI);\n    context.stroke();\n  }, []);\n  useEffect(() => {\n    const updateCameraComment = cameraId => {\n      const selectedCamera = allCameras.find(camera => camera.camera_id === cameras[cameraId].formValues.camId);\n      if (!selectedCamera) {\n        setCameras(prevCameras => ({\n          ...prevCameras,\n          [cameraId]: {\n            ...prevCameras[cameraId],\n            comment: \"Select a camera\",\n            isVirtual: true\n          }\n        }));\n        return;\n      }\n      ;\n      const isVirtual = !selectedCamera.details.is_real;\n      let comment = selectedCamera.details.comment;\n      comment = comment + \" | \" + (isVirtual ? \"Virtual Camera\" : \"Real Camera\");\n      setCameras(prevCameras => ({\n        ...prevCameras,\n        [cameraId]: {\n          ...prevCameras[cameraId],\n          comment: comment,\n          isVirtual: isVirtual\n        }\n      }));\n    };\n    updateCameraComment(1);\n    updateCameraComment(2);\n  }, [cameras[1].formValues.camId, cameras[2].formValues.camId, allCameras]);\n  const showToast = (msg, type, delay = 2000) => {\n    toast[type](msg, {\n      position: \"bottom-right\",\n      autoClose: delay,\n      hideProgressBar: false,\n      closeOnClick: true,\n      pauseOnHover: true,\n      draggable: true,\n      progress: undefined,\n      theme: \"dark\",\n      transition: Slide\n    });\n  };\n  const throwErrorIfNotSuccess = (response, toastId) => {\n    const success = response.data.success;\n    // raise error is success is false with response message\n    if (!success) {\n      if (toastId) {\n        toast.update(toastId, {\n          render: response.data.msg,\n          type: \"error\",\n          isLoading: false,\n          autoClose: 1000\n        });\n      }\n      throw new Error(response.data.msg);\n    }\n  };\n  const handlePreviewToggle = async cameraId => {\n    const isPreviewActive = cameras[cameraId].isPreviewActive;\n    setCameras(prevCameras => ({\n      ...prevCameras,\n      [cameraId]: {\n        ...prevCameras[cameraId],\n        isSwitchActive: false\n      }\n    }));\n    const action = isPreviewActive ? 'Shutting down' : 'Warming up';\n    let toastId = toast.loading(`${action} Cam ${cameraId} Server`, {\n      position: \"top-center\",\n      autoClose: 2000,\n      theme: \"dark\",\n      transition: Slide\n    });\n    try {\n      const endpoint = isPreviewActive ? '/stop_camera/' : `/warmup/camserver/${cameraId}`;\n      const baseURL = isPreviewActive ? camServerURLs[cameraId] : mainServerURL; // Use main server for warming up\n      const response = await axios[isPreviewActive ? 'post' : 'post'](baseURL + endpoint);\n      throwErrorIfNotSuccess(response, toastId);\n      setCameras(prevCameras => ({\n        ...prevCameras,\n        [cameraId]: {\n          ...prevCameras[cameraId],\n          isSwitchActive: true,\n          isPreviewActive: !isPreviewActive,\n          isStreaming: isPreviewActive ? false : prevCameras[cameraId].isStreaming\n        }\n      }));\n      toast.update(toastId, {\n        render: response.data.msg,\n        type: response.data.success ? \"success\" : \"error\",\n        isLoading: false,\n        autoClose: 2000\n      });\n    } catch (error) {\n      // revert the camera switch to active\n      setCameras(prevCameras => ({\n        ...prevCameras,\n        [cameraId]: {\n          ...prevCameras[cameraId],\n          isSwitchActive: true\n        }\n      }));\n      showToast(`Error in ${action.toLowerCase()} Cam Server ${cameraId}`, \"error\");\n      showToast(error.message, \"error\");\n    }\n  };\n  const handleStreamToggle = async cameraId => {\n    const isStreaming = cameras[cameraId].isStreaming;\n    setCameras(prevCameras => ({\n      ...prevCameras,\n      [cameraId]: {\n        ...prevCameras[cameraId],\n        isSwitchActive: false\n      }\n    }));\n    const action = isStreaming ? 'Stopping' : 'Starting';\n    let toastId = toast.loading(`${action} ${cameras[cameraId].formValues.camId}`, {\n      position: \"top-center\",\n      autoClose: 2000,\n      theme: \"dark\",\n      transition: Slide\n    });\n    try {\n      const endpoint = isStreaming ? 'stop_camera/' : 'start_camera/';\n      const data = isStreaming ? {} : {\n        camera_id: cameras[cameraId].formValues.camId,\n        fps: cameras[cameraId].formValues.targetFPS,\n        exposure_time: cameras[cameraId].formValues.exposureTime,\n        gain: cameras[cameraId].formValues.gain,\n        image_format: cameras[cameraId].formValues.imageFormat,\n        folder_path: cameras[cameraId].formValues.folderPath\n      };\n      const response = await axios.post(camServerURLs[cameraId] + `/${endpoint}`, data);\n      throwErrorIfNotSuccess(response, toastId);\n      setCameras(prevCameras => ({\n        ...prevCameras,\n        [cameraId]: {\n          ...prevCameras[cameraId],\n          isSwitchActive: true,\n          isStreaming: !isStreaming\n        }\n      }));\n      toast.update(toastId, {\n        render: response.data.msg,\n        type: response.data.success ? \"success\" : \"error\",\n        isLoading: false,\n        autoClose: 2000\n      });\n    } catch (error) {\n      // revert the camera switch to active\n      setCameras(prevCameras => ({\n        ...prevCameras,\n        [cameraId]: {\n          ...prevCameras[cameraId],\n          isSwitchActive: true\n        }\n      }));\n      showToast(`Error in ${action.toLowerCase()} camera ${cameraId}`, \"error\");\n      showToast(error.message, \"error\");\n    }\n  };\n  useEffect(() => {\n    const webSocketConnections = {}; // Store WebSocket connections\n\n    const connectToWebSocket = cameraId => {\n      if (!cameras[cameraId].isPreviewActive || webSocketConnections[cameraId]) return;\n      let frameCount = 0;\n      let dataCount = 0;\n      let firstImageReceived = false;\n      const ip = camServerURLs[cameraId].replace(/(^\\w+:|^)\\/\\//, '');\n      const websocket = new WebSocket(\"ws://\" + ip + \"/ws\");\n      webSocketConnections[cameraId] = websocket; // Store the connection\n      websocket.binaryType = 'blob';\n      const updateFpsAndSpeed = () => {\n        console.log(frameCount, cameraId);\n\n        // set the fps and speed for the camera\n        const copyFrameCount = frameCount;\n        const copyDataCount = dataCount;\n        setCameras(prevCameras => ({\n          ...prevCameras,\n          [cameraId]: {\n            ...prevCameras[cameraId],\n            fps: copyFrameCount,\n            rxSpeed: copyDataCount / 1024\n          }\n        }));\n        frameCount = 0;\n        dataCount = 0;\n      };\n      const intervalId = setInterval(updateFpsAndSpeed, 1000);\n      const img = new Image();\n      img.onload = () => {\n        const canvas = canvasRefs[cameraId].current;\n        const ctx = canvas.getContext('2d');\n        if (!firstImageReceived) {\n          // now apply the rule that max width is 1000\n          const scaleFactor = maxWidth / img.width;\n          canvas.width = img.width * scaleFactor;\n          canvas.height = img.height * scaleFactor;\n          firstImageReceived = true;\n          setCameras(prevCameras => ({\n            ...prevCameras,\n            [cameraId]: {\n              ...prevCameras[cameraId],\n              isFirstImageReceived: true,\n              canvasWidth: canvas.width,\n              canvasHeight: canvas.height\n            }\n          }));\n          imageProps.width = img.width;\n          imageProps.height = img.height;\n          drawProps.scale = scaleFactor;\n          drawProps.centerX = canvas.width / 2;\n          drawProps.centerY = canvas.height / 2;\n          const rect = canvas.getBoundingClientRect();\n          drawProps.startX = rect.left;\n          drawProps.startY = rect.top;\n          drawProps.endX = rect.right;\n          drawProps.endY = rect.bottom;\n\n          // set the height and width of the other two canvases\n          canvasTrackRef.current.width = canvas.width;\n          canvasTrackRef.current.height = canvas.height;\n          canvasHologramRef.current.width = canvas.width;\n          canvasHologramRef.current.height = canvas.height;\n        }\n        ctx.drawImage(img, 0, 0, img.width, img.height, 0, 0, canvas.width, canvas.height);\n        URL.revokeObjectURL(img.src);\n      };\n      websocket.onmessage = event => {\n        const url = URL.createObjectURL(event.data);\n        img.src = url;\n        frameCount++;\n        dataCount += event.data.size;\n      };\n      websocket.onopen = () => console.log(`Connected to Cam Server ${cameraId}`);\n      websocket.onerror = error => console.error('WebSocket error:', error);\n      websocket.onclose = () => {\n        console.log(`Disconnected from Cam Server ${cameraId}`);\n        clearInterval(intervalId);\n        delete webSocketConnections[cameraId]; // Remove connection from the object\n      };\n    };\n    connectToWebSocket(1);\n    connectToWebSocket(2);\n\n    // Clean up WebSocket connections when component unmounts\n    return () => {\n      Object.values(webSocketConnections).forEach(ws => ws.close());\n    };\n  }, [cameras[1].isPreviewActive, cameras[2].isPreviewActive]);\n  const renderCameraControls = cameraId => {\n    const {\n      isPreviewActive,\n      isStreaming,\n      showModalSettings,\n      isSwitchActive,\n      formValues,\n      comment,\n      isVirtual,\n      fps,\n      rxSpeed\n    } = cameras[cameraId];\n    const handleModalToggle = () => setCameras(prevCameras => ({\n      ...prevCameras,\n      [cameraId]: {\n        ...prevCameras[cameraId],\n        showModalSettings: !prevCameras[cameraId].showModalSettings\n      }\n    }));\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"d-flex justify-content-center justify-content-center align-items-center\",\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"d-flex align-items-center me-3 fs-4 fw-bold\",\n        style: {\n          color: !isSwitchActive ? 'gray' : 'inherit'\n        },\n        children: [\"Cam \", cameraId, /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            height: '10px',\n            width: '10px',\n            backgroundColor: isPreviewActive ? 'green' : 'red',\n            borderRadius: '50%',\n            display: 'inline-block',\n            marginLeft: '5px'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 519,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 517,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"d-flex justify-content-center\",\n        style: {\n          marginLeft: '30px'\n        },\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"btn-group\",\n          children: [/*#__PURE__*/_jsxDEV(Button, {\n            variant: \"primary\",\n            onClick: handleModalToggle,\n            disabled: !isPreviewActive || !isSwitchActive || isStreaming,\n            children: /*#__PURE__*/_jsxDEV(FontAwesomeIcon, {\n              icon: faCog\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 545,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 544,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            variant: \"primary\",\n            onClick: () => handleStreamToggle(cameraId),\n            disabled: !isPreviewActive || !isSwitchActive,\n            style: {\n              backgroundColor: isStreaming ? 'orange' : ''\n            },\n            children: isStreaming ? 'Stop Stream' : 'Start Stream'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 547,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 543,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 542,\n        columnNumber: 9\n      }, this), 1 == 1 && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"d-flex justify-content-center\",\n        style: {\n          marginLeft: '30px'\n        },\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [\"FPS: \", fps.toFixed(2), \" | Rx Speed: \", (rxSpeed / 1024).toFixed(2), \" Mb/s\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 560,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 559,\n        columnNumber: 11\n      }, this)]\n    }, cameraId, true, {\n      fileName: _jsxFileName,\n      lineNumber: 514,\n      columnNumber: 7\n    }, this);\n  };\n  const renderCameraModal = cameraId => {\n    const {\n      showModalSettings,\n      formValues,\n      comment,\n      isVirtual\n    } = cameras[cameraId];\n    const handleCloseModal = () => setCameras(prevCameras => ({\n      ...prevCameras,\n      [cameraId]: {\n        ...prevCameras[cameraId],\n        showModalSettings: false\n      }\n    }));\n    return /*#__PURE__*/_jsxDEV(Modal, {\n      show: showModalSettings,\n      onHide: handleCloseModal,\n      children: [/*#__PURE__*/_jsxDEV(Modal.Header, {\n        closeButton: true,\n        children: /*#__PURE__*/_jsxDEV(Modal.Title, {\n          children: [\"Cam Server \", cameraId, \" Configuration\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 580,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 579,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Modal.Body, {\n        children: /*#__PURE__*/_jsxDEV(Form, {\n          children: [/*#__PURE__*/_jsxDEV(Form.Group, {\n            className: \"mb-3\",\n            children: [/*#__PURE__*/_jsxDEV(Form.Label, {\n              children: \"Camera ID\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 585,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Form.Select, {\n              name: \"camId\",\n              onChange: e => handleInputChange(e, cameraId),\n              value: formValues.camId,\n              children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"\",\n                children: \"Select Option\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 587,\n                columnNumber: 17\n              }, this), allCameras.map((camera, index) => /*#__PURE__*/_jsxDEV(\"option\", {\n                value: camera.camera_id,\n                children: camera.camera_id\n              }, index, false, {\n                fileName: _jsxFileName,\n                lineNumber: 589,\n                columnNumber: 19\n              }, this))]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 586,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Form.Text, {\n              className: \"text-muted\",\n              children: comment\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 594,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 584,\n            columnNumber: 13\n          }, this), isVirtual && /*#__PURE__*/_jsxDEV(Form.Group, {\n            className: \"mb-3\",\n            children: [/*#__PURE__*/_jsxDEV(Form.Label, {\n              children: \"Folder Path\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 600,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Form.Control, {\n              name: \"folderPath\",\n              placeholder: \"Enter folder path\",\n              onChange: e => handleInputChange(e, cameraId),\n              value: formValues.folderPath\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 601,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 599,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(Form.Group, {\n            className: \"mb-3\",\n            children: [/*#__PURE__*/_jsxDEV(Form.Label, {\n              children: \"Target Streaming FPS\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 605,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Form.Control, {\n              name: \"targetFPS\",\n              type: \"number\",\n              placeholder: \"Enter FPS\",\n              onChange: e => handleInputChange(e, cameraId),\n              value: formValues.targetFPS\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 606,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 604,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Form.Group, {\n            className: \"mb-3\",\n            children: [/*#__PURE__*/_jsxDEV(Form.Label, {\n              children: \"Exposure Time (ms)\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 609,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Form.Control, {\n              name: \"exposureTime\",\n              type: \"number\",\n              step: \"0.01\",\n              placeholder: \"Enter exposure time in ms\",\n              onChange: e => handleInputChange(e, cameraId),\n              value: formValues.exposureTime\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 610,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 608,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Form.Group, {\n            className: \"mb-3\",\n            children: [/*#__PURE__*/_jsxDEV(Form.Label, {\n              children: \"Gain\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 621,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Form.Control, {\n              name: \"gain\",\n              type: \"number\",\n              step: \"0.01\",\n              placeholder: \"Enter gain\",\n              onChange: e => handleInputChange(e, cameraId),\n              value: formValues.gain\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 622,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 620,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Form.Group, {\n            className: \"mb-3\",\n            children: [/*#__PURE__*/_jsxDEV(Form.Label, {\n              children: \"Image Format\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 634,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Form.Select, {\n              name: \"imageFormat\",\n              onChange: e => handleInputChange(e, cameraId),\n              value: formValues.imageFormat,\n              children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"compressed\",\n                children: \"Compressed\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 636,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"original\",\n                children: \"Original\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 637,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 635,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 633,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 583,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 582,\n        columnNumber: 9\n      }, this)]\n    }, cameraId, true, {\n      fileName: _jsxFileName,\n      lineNumber: 578,\n      columnNumber: 7\n    }, this);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"p-3\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"d-flex flex-row justify-content-between\",\n      children: [1, 2].map(cameraId => renderCameraControls(cameraId))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 648,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: 'grid',\n        width: '100%',\n        height: '100%',\n        marginTop: '20px',\n        justifyContent: 'center',\n        alignItems: 'center',\n        position: 'relative',\n        placeItems: 'center'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"canvas\", {\n        ref: canvasRefs[1],\n        style: {\n          gridArea: '1 / 1 / 2 / 2',\n          opacity: 1.0,\n          zIndex: 1,\n          backgroundColor: 'transparent'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 672,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n        ref: canvasRefs[2],\n        style: {\n          gridArea: '1 / 1 / 2 / 2',\n          opacity: 0.5,\n          zIndex: 2,\n          backgroundColor: 'transparent'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 681,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n        ref: canvasTrackRef,\n        style: {\n          gridArea: '1 / 1 / 2 / 2',\n          opacity: 1.0,\n          zIndex: 3,\n          backgroundColor: 'transparent'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 691,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n        ref: canvasHologramRef,\n        style: {\n          gridArea: '1 / 1 / 2 / 2',\n          opacity: 1.0,\n          zIndex: 4,\n          backgroundColor: 'transparent'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 703,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 662,\n      columnNumber: 7\n    }, this), [1, 2].map(cameraId => renderCameraModal(cameraId)), /*#__PURE__*/_jsxDEV(ToastContainer, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 717,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 647,\n    columnNumber: 5\n  }, this);\n}\n_s(CameraPreview, \"YCl4btdqusqlMSpnLfyVfnhxv9s=\", false, function () {\n  return [useCanvases];\n});\n_c = CameraPreview;\nexport default CameraPreview;\nvar _c;\n$RefreshReg$(_c, \"CameraPreview\");","map":{"version":3,"names":["React","useState","useEffect","useRef","Modal","Button","Form","FontAwesomeIcon","faCog","ToastContainer","toast","Slide","axios","useCanvases","jsxDEV","_jsxDEV","mainServerURL","camServerURLs","CameraPreview","_s","allCameras","setAllCameras","canvasTrackRef","canvasHologramRef","canvasRefs","imageProps","drawProps","drawing","draw","event","canvas","current","ctx","getContext","rect","getBoundingClientRect","x","clientX","startX","y","clientY","startY","lineWidth","lineCap","strokeStyle","lineTo","stroke","beginPath","moveTo","startDrawing","stopDrawing","addEventListener","removeEventListener","maxWidth","setMaxWidth","cameras","setCameras","_storedCameras$","_storedCameras$$formV","_storedCameras$2","_storedCameras$2$form","_storedCameras$3","_storedCameras$3$form","_storedCameras$4","_storedCameras$4$form","_storedCameras$5","_storedCameras$5$form","_storedCameras$6","_storedCameras$6$form","_storedCameras$7","_storedCameras$7$form","_storedCameras$8","_storedCameras$8$form","_storedCameras$9","_storedCameras$9$form","_storedCameras$10","_storedCameras$10$for","_storedCameras$11","_storedCameras$11$for","_storedCameras$12","_storedCameras$12$for","storedCameras","JSON","parse","localStorage","getItem","isPreviewActive","isStreaming","showModalSettings","isSwitchActive","formValues","camId","folderPath","targetFPS","imageFormat","exposureTime","gain","comment","isVirtual","fps","rxSpeed","isFirstImageReceived","canvasWidth","canvasHeight","setItem","stringify","fetchCameraDetails","response","get","throwErrorIfNotSuccess","data","error","showToast","message","handleInputChange","cameraId","prevCameras","target","name","value","context","arc","Math","PI","updateCameraComment","selectedCamera","find","camera","camera_id","details","is_real","msg","type","delay","position","autoClose","hideProgressBar","closeOnClick","pauseOnHover","draggable","progress","undefined","theme","transition","toastId","success","update","render","isLoading","Error","handlePreviewToggle","action","loading","endpoint","baseURL","toLowerCase","handleStreamToggle","exposure_time","image_format","folder_path","post","webSocketConnections","connectToWebSocket","frameCount","dataCount","firstImageReceived","ip","replace","websocket","WebSocket","binaryType","updateFpsAndSpeed","console","log","copyFrameCount","copyDataCount","intervalId","setInterval","img","Image","onload","scaleFactor","width","height","scale","centerX","centerY","left","top","endX","right","endY","bottom","drawImage","URL","revokeObjectURL","src","onmessage","url","createObjectURL","size","onopen","onerror","onclose","clearInterval","Object","values","forEach","ws","close","renderCameraControls","handleModalToggle","className","children","style","color","backgroundColor","borderRadius","display","marginLeft","fileName","_jsxFileName","lineNumber","columnNumber","variant","onClick","disabled","icon","toFixed","renderCameraModal","handleCloseModal","show","onHide","Header","closeButton","Title","Body","Group","Label","Select","onChange","e","map","index","Text","Control","placeholder","step","marginTop","justifyContent","alignItems","placeItems","ref","gridArea","opacity","zIndex","_c","$RefreshReg$"],"sources":["F:/tweezerui/src/components/CameraPreview/CameraPreview.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { Modal, Button, Form } from 'react-bootstrap';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { faCog } from '@fortawesome/free-solid-svg-icons';\r\nimport 'bootstrap/dist/css/bootstrap.min.css';\r\nimport { ToastContainer, toast } from 'react-toastify';\r\nimport 'react-toastify/dist/ReactToastify.css';\r\nimport { Slide } from 'react-toastify';\r\nimport axios from 'axios';\r\nimport { useCanvases } from '../../CanvasContext';\r\nconst mainServerURL = \"http://10.0.63.153:4000\";\r\nconst camServerURLs = {\r\n  1: \"http://10.0.63.153:4001\",\r\n  2: \"http://10.0.63.153:4002\"\r\n};\r\n\r\nfunction CameraPreview() {\r\n  const [allCameras, setAllCameras] = useState([]);\r\n  // const [canvasSize, setCanvasSize] = useState({ width: 0, height: 0 });\r\n  const canvasTrackRef = useRef(null);\r\n  const canvasHologramRef = useRef(null);\r\n\r\n  const { canvasRefs, imageProps, drawProps } = useCanvases();\r\n\r\n  let drawing = false;\r\n\r\n  const draw = (event) => {\r\n    if (!drawing) return;\r\n    const canvas = canvasHologramRef.current;\r\n    const ctx = canvas.getContext('2d');\r\n    const rect = canvas.getBoundingClientRect(); // get the position of the canvas\r\n\r\n\r\n\r\n    const x = event.clientX - drawProps.startX;\r\n    const y = event.clientY - drawProps.startY;\r\n\r\n    ctx.lineWidth = 5;\r\n    ctx.lineCap = 'round';\r\n    ctx.strokeStyle = 'red';\r\n\r\n    ctx.lineTo(x, y);\r\n    ctx.stroke();\r\n    ctx.beginPath();\r\n    ctx.moveTo(x, y);\r\n  };\r\n\r\n  const startDrawing = (event) => {\r\n    drawing = true;\r\n    draw(event);\r\n  };\r\n\r\n  const stopDrawing = () => {\r\n    drawing = false;\r\n    const canvas = canvasHologramRef.current;\r\n    const ctx = canvas.getContext('2d');\r\n    ctx.beginPath();\r\n  };\r\n\r\n  useEffect(() => {\r\n    const canvas = canvasHologramRef.current;\r\n    canvas.addEventListener('mousedown', startDrawing);\r\n    canvas.addEventListener('mousemove', draw);\r\n    canvas.addEventListener('mouseup', stopDrawing);\r\n    canvas.addEventListener('mouseout', stopDrawing);\r\n\r\n    return () => {\r\n      canvas.removeEventListener('mousedown', startDrawing);\r\n      canvas.removeEventListener('mousemove', draw);\r\n      canvas.removeEventListener('mouseup', stopDrawing);\r\n      canvas.removeEventListener('mouseout', stopDrawing);\r\n    };\r\n  }, []);\r\n\r\n\r\n\r\n  const [maxWidth, setMaxWidth] = useState(1000);\r\n\r\n  const [cameras, setCameras] = useState(() => {\r\n    // Load initial camera state from localStorage\r\n    const storedCameras = JSON.parse(localStorage.getItem('cameras')) || {};\r\n    return {\r\n      1: {\r\n        isPreviewActive: true,\r\n        isStreaming: false,\r\n        showModalSettings: false,\r\n        isSwitchActive: true,\r\n        formValues: {\r\n          camId: storedCameras[1]?.formValues?.camId || 'Select Option',\r\n          folderPath: storedCameras[1]?.formValues?.folderPath || 'F:/',\r\n          targetFPS: storedCameras[1]?.formValues?.targetFPS || '10',\r\n          imageFormat: storedCameras[1]?.formValues?.imageFormat || '',\r\n          exposureTime: storedCameras[1]?.formValues?.exposureTime || \"10.0\",\r\n          gain: storedCameras[1]?.formValues?.gain || \"1.0\",\r\n        },\r\n        comment: \"Select the camera ID from the dropdown list\",\r\n        isVirtual: false,\r\n        fps: 0,\r\n        rxSpeed: 0.0,\r\n        isFirstImageReceived: false,\r\n        canvasWidth: -1,\r\n        canvasHeight: -1\r\n      },\r\n      2: {\r\n        isPreviewActive: false,\r\n        isStreaming: false,\r\n        showModalSettings: false,\r\n        isSwitchActive: true,\r\n        formValues: {\r\n          camId: storedCameras[2]?.formValues?.camId || 'Select Option',\r\n          folderPath: storedCameras[2]?.formValues?.folderPath || 'F:/',\r\n          targetFPS: storedCameras[2]?.formValues?.targetFPS || '10',\r\n          imageFormat: storedCameras[2]?.formValues?.imageFormat || '',\r\n          exposureTime: storedCameras[2]?.formValues?.exposureTime || \"10.0\",\r\n          gain: storedCameras[2]?.formValues?.gain || \"1.0\",\r\n        },\r\n        comment: \"Select the camera ID from the dropdown list\",\r\n        isVirtual: false,\r\n        fps: 0,\r\n        rxSpeed: 0.0,\r\n        isFirstImageReceived: false,\r\n        canvasWidth: -1,\r\n        canvasHeight: -1,\r\n      }\r\n    };\r\n  });\r\n\r\n\r\n\r\n\r\n  useEffect(() => {\r\n    localStorage.setItem('cameras', JSON.stringify(cameras));\r\n  }, [cameras]);\r\n\r\n  useEffect(() => {\r\n    const fetchCameraDetails = async () => {\r\n      if (cameras[1].showModalSettings || cameras[2].showModalSettings) {\r\n        try {\r\n          const response = await axios.get(camServerURLs[1] + \"/get_all_camera_details\");\r\n          throwErrorIfNotSuccess(response, null);\r\n\r\n\r\n          setAllCameras(response.data.data);\r\n        } catch (error) {\r\n          showToast(\"Error in fetching camera details\", \"error\");\r\n          showToast(error.message, \"error\");\r\n        }\r\n      }\r\n    };\r\n\r\n    fetchCameraDetails();\r\n  }, [cameras[1].showModalSettings, cameras[2].showModalSettings]);\r\n\r\n\r\n  // useEffect(() => {\r\n  //   Object.values(canvasRefs).forEach((canvasRef, cameraId) => {\r\n  //     if (canvasRef.current) {\r\n  //       setCanvasSize(prevCanvasSize => ({\r\n  //         ...prevCanvasSize,\r\n  //         [cameraId]: {\r\n  //           width: canvasRef.current.offsetWidth,\r\n  //           height: canvasRef.current.offsetHeight,\r\n\r\n  //         }\r\n  //       }));\r\n  //     }\r\n  //   });\r\n  // }, []);\r\n\r\n  const handleInputChange = (event, cameraId) => {\r\n    setCameras(prevCameras => ({\r\n      ...prevCameras,\r\n      [cameraId]: {\r\n        ...prevCameras[cameraId],\r\n        formValues: {\r\n          ...prevCameras[cameraId].formValues,\r\n          [event.target.name]: event.target.value,\r\n        },\r\n      }\r\n    }));\r\n  };\r\n\r\n  useEffect(() => {\r\n    const canvas = canvasHologramRef.current;\r\n    const context = canvas.getContext('2d');\r\n\r\n    // Draw a hollow circle at x =100, y = 50\r\n    context.beginPath();\r\n    context.arc(150, 50, 20, 0, 2 * Math.PI);\r\n    context.stroke();\r\n\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const updateCameraComment = (cameraId) => {\r\n      const selectedCamera = allCameras.find((camera) => camera.camera_id === cameras[cameraId].formValues.camId);\r\n      if (!selectedCamera) {\r\n        setCameras(prevCameras => ({\r\n          ...prevCameras,\r\n          [cameraId]: {\r\n            ...prevCameras[cameraId],\r\n            comment: \"Select a camera\",\r\n            isVirtual: true,\r\n          }\r\n        }));\r\n\r\n        return\r\n      };\r\n\r\n      const isVirtual = !selectedCamera.details.is_real;\r\n      let comment = selectedCamera.details.comment;\r\n      comment = comment + \" | \" + (isVirtual ? \"Virtual Camera\" : \"Real Camera\");\r\n\r\n      setCameras(prevCameras => ({\r\n        ...prevCameras,\r\n        [cameraId]: {\r\n          ...prevCameras[cameraId],\r\n          comment: comment,\r\n          isVirtual: isVirtual,\r\n        }\r\n      }));\r\n    };\r\n\r\n    updateCameraComment(1);\r\n    updateCameraComment(2);\r\n  }, [cameras[1].formValues.camId, cameras[2].formValues.camId, allCameras]);\r\n\r\n  const showToast = (msg, type, delay = 2000) => {\r\n    toast[type](msg, {\r\n      position: \"bottom-right\",\r\n      autoClose: delay,\r\n      hideProgressBar: false,\r\n      closeOnClick: true,\r\n      pauseOnHover: true,\r\n      draggable: true,\r\n      progress: undefined,\r\n      theme: \"dark\",\r\n      transition: Slide,\r\n    });\r\n  };\r\n\r\n  const throwErrorIfNotSuccess = (response, toastId) => {\r\n\r\n    const success = response.data.success;\r\n    // raise error is success is false with response message\r\n    if (!success) {\r\n\r\n\r\n      if (toastId) {\r\n        toast.update(toastId, {\r\n          render: response.data.msg,\r\n          type: \"error\",\r\n          isLoading: false,\r\n          autoClose: 1000,\r\n        });\r\n      }\r\n      throw new Error(response.data.msg);\r\n    }\r\n\r\n\r\n\r\n  };\r\n\r\n  const handlePreviewToggle = async (cameraId) => {\r\n    const isPreviewActive = cameras[cameraId].isPreviewActive;\r\n    setCameras(prevCameras => ({\r\n      ...prevCameras,\r\n      [cameraId]: {\r\n        ...prevCameras[cameraId],\r\n        isSwitchActive: false,\r\n      }\r\n    }));\r\n\r\n    const action = isPreviewActive ? 'Shutting down' : 'Warming up';\r\n    let toastId = toast.loading(`${action} Cam ${cameraId} Server`, {\r\n      position: \"top-center\",\r\n      autoClose: 2000,\r\n      theme: \"dark\",\r\n      transition: Slide,\r\n    });\r\n\r\n    try {\r\n      const endpoint = isPreviewActive ? '/stop_camera/' : `/warmup/camserver/${cameraId}`;\r\n      const baseURL = isPreviewActive ? camServerURLs[cameraId] : mainServerURL; // Use main server for warming up\r\n      const response = await axios[isPreviewActive ? 'post' : 'post'](baseURL + endpoint);\r\n\r\n      throwErrorIfNotSuccess(response, toastId);\r\n\r\n      setCameras(prevCameras => ({\r\n        ...prevCameras,\r\n        [cameraId]: {\r\n          ...prevCameras[cameraId],\r\n          isSwitchActive: true,\r\n          isPreviewActive: !isPreviewActive,\r\n          isStreaming: isPreviewActive ? false : prevCameras[cameraId].isStreaming,\r\n        }\r\n      }));\r\n\r\n      toast.update(toastId, {\r\n        render: response.data.msg,\r\n        type: response.data.success ? \"success\" : \"error\",\r\n        isLoading: false,\r\n        autoClose: 2000,\r\n      });\r\n    } catch (error) {\r\n\r\n      // revert the camera switch to active\r\n      setCameras(prevCameras => ({\r\n        ...prevCameras,\r\n        [cameraId]: {\r\n          ...prevCameras[cameraId],\r\n          isSwitchActive: true,\r\n        }\r\n      }));\r\n      showToast(`Error in ${action.toLowerCase()} Cam Server ${cameraId}`, \"error\");\r\n      showToast(error.message, \"error\");\r\n    }\r\n  };\r\n\r\n  const handleStreamToggle = async (cameraId) => {\r\n    const isStreaming = cameras[cameraId].isStreaming;\r\n    setCameras(prevCameras => ({\r\n      ...prevCameras,\r\n      [cameraId]: {\r\n        ...prevCameras[cameraId],\r\n        isSwitchActive: false,\r\n      }\r\n    }));\r\n\r\n    const action = isStreaming ? 'Stopping' : 'Starting';\r\n    let toastId = toast.loading(`${action} ${cameras[cameraId].formValues.camId}`, {\r\n      position: \"top-center\",\r\n      autoClose: 2000,\r\n      theme: \"dark\",\r\n      transition: Slide,\r\n    });\r\n\r\n    try {\r\n      const endpoint = isStreaming ? 'stop_camera/' : 'start_camera/';\r\n      const data = isStreaming ? {} : {\r\n        camera_id: cameras[cameraId].formValues.camId,\r\n        fps: cameras[cameraId].formValues.targetFPS,\r\n        exposure_time: cameras[cameraId].formValues.exposureTime,\r\n        gain: cameras[cameraId].formValues.gain,\r\n        image_format: cameras[cameraId].formValues.imageFormat,\r\n        folder_path: cameras[cameraId].formValues.folderPath,\r\n      };\r\n\r\n      const response = await axios.post(camServerURLs[cameraId] + `/${endpoint}`, data);\r\n\r\n      throwErrorIfNotSuccess(response, toastId);\r\n\r\n      setCameras(prevCameras => ({\r\n        ...prevCameras,\r\n        [cameraId]: {\r\n          ...prevCameras[cameraId],\r\n          isSwitchActive: true,\r\n          isStreaming: !isStreaming,\r\n        }\r\n      }));\r\n\r\n      toast.update(toastId, {\r\n        render: response.data.msg,\r\n        type: response.data.success ? \"success\" : \"error\",\r\n        isLoading: false,\r\n        autoClose: 2000,\r\n      });\r\n    } catch (error) {\r\n\r\n      // revert the camera switch to active\r\n      setCameras(prevCameras => ({\r\n        ...prevCameras,\r\n        [cameraId]: {\r\n          ...prevCameras[cameraId],\r\n          isSwitchActive: true,\r\n        }\r\n      }));\r\n\r\n\r\n      showToast(`Error in ${action.toLowerCase()} camera ${cameraId}`, \"error\");\r\n      showToast(error.message, \"error\");\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    const webSocketConnections = {}; // Store WebSocket connections\r\n\r\n    const connectToWebSocket = (cameraId) => {\r\n      if (!cameras[cameraId].isPreviewActive || webSocketConnections[cameraId]) return;\r\n\r\n      let frameCount = 0;\r\n      let dataCount = 0;\r\n      let firstImageReceived = false;\r\n\r\n      const ip = camServerURLs[cameraId].replace(/(^\\w+:|^)\\/\\//, '');\r\n      const websocket = new WebSocket(\"ws://\" + ip + \"/ws\");\r\n      webSocketConnections[cameraId] = websocket; // Store the connection\r\n      websocket.binaryType = 'blob';\r\n\r\n      const updateFpsAndSpeed = () => {\r\n        console.log(frameCount, cameraId)\r\n\r\n        // set the fps and speed for the camera\r\n        const copyFrameCount = frameCount;\r\n        const copyDataCount = dataCount;\r\n\r\n\r\n        setCameras(prevCameras => ({\r\n          ...prevCameras,\r\n          [cameraId]: {\r\n            ...prevCameras[cameraId],\r\n            fps: copyFrameCount,\r\n            rxSpeed: copyDataCount / 1024,\r\n          }\r\n        }));\r\n\r\n        frameCount = 0;\r\n        dataCount = 0;\r\n      };\r\n\r\n      const intervalId = setInterval(updateFpsAndSpeed, 1000);\r\n\r\n      const img = new Image();\r\n      img.onload = () => {\r\n        const canvas = canvasRefs[cameraId].current;\r\n        const ctx = canvas.getContext('2d');\r\n        if (!firstImageReceived) {\r\n\r\n\r\n          // now apply the rule that max width is 1000\r\n          const scaleFactor = maxWidth / img.width;\r\n          canvas.width = img.width * scaleFactor;\r\n          canvas.height = img.height * scaleFactor;\r\n          firstImageReceived = true;\r\n\r\n          setCameras(prevCameras => ({\r\n            ...prevCameras,\r\n            [cameraId]: {\r\n              ...prevCameras[cameraId],\r\n              isFirstImageReceived: true,\r\n              canvasWidth: canvas.width,\r\n              canvasHeight: canvas.height,\r\n            }\r\n\r\n          }));\r\n\r\n\r\n          imageProps.width = img.width;\r\n          imageProps.height = img.height;\r\n\r\n          drawProps.scale = scaleFactor;\r\n          drawProps.centerX = canvas.width / 2;\r\n          drawProps.centerY = canvas.height / 2;\r\n\r\n          const rect = canvas.getBoundingClientRect();\r\n          drawProps.startX = rect.left;\r\n          drawProps.startY = rect.top;\r\n          drawProps.endX = rect.right;\r\n          drawProps.endY = rect.bottom;\r\n\r\n\r\n\r\n\r\n          // set the height and width of the other two canvases\r\n          canvasTrackRef.current.width = canvas.width;\r\n          canvasTrackRef.current.height = canvas.height;\r\n          canvasHologramRef.current.width = canvas.width;\r\n          canvasHologramRef.current.height = canvas.height;\r\n\r\n\r\n        }\r\n        ctx.drawImage(img, 0, 0, img.width, img.height, 0, 0, canvas.width, canvas.height);\r\n        URL.revokeObjectURL(img.src);\r\n      };\r\n\r\n      websocket.onmessage = (event) => {\r\n        const url = URL.createObjectURL(event.data);\r\n        img.src = url;\r\n        frameCount++;\r\n        dataCount += event.data.size;\r\n      };\r\n\r\n      websocket.onopen = () => console.log(`Connected to Cam Server ${cameraId}`);\r\n      websocket.onerror = (error) => console.error('WebSocket error:', error);\r\n      websocket.onclose = () => {\r\n        console.log(`Disconnected from Cam Server ${cameraId}`);\r\n        clearInterval(intervalId);\r\n        delete webSocketConnections[cameraId]; // Remove connection from the object\r\n      };\r\n    };\r\n\r\n    connectToWebSocket(1);\r\n    connectToWebSocket(2);\r\n\r\n    // Clean up WebSocket connections when component unmounts\r\n    return () => {\r\n      Object.values(webSocketConnections).forEach(ws => ws.close());\r\n    };\r\n\r\n  }, [cameras[1].isPreviewActive, cameras[2].isPreviewActive]);\r\n\r\n\r\n  const renderCameraControls = (cameraId) => {\r\n    const { isPreviewActive, isStreaming, showModalSettings, isSwitchActive, formValues, comment, isVirtual, fps, rxSpeed } = cameras[cameraId];\r\n    const handleModalToggle = () => setCameras(prevCameras => ({\r\n      ...prevCameras,\r\n      [cameraId]: {\r\n        ...prevCameras[cameraId],\r\n        showModalSettings: !prevCameras[cameraId].showModalSettings,\r\n      }\r\n    }));\r\n\r\n    return (\r\n      <div className=\"d-flex justify-content-center justify-content-center align-items-center\" key={cameraId}>\r\n\r\n\r\n        <span className=\"d-flex align-items-center me-3 fs-4 fw-bold\" style={{ color: !isSwitchActive ? 'gray' : 'inherit' }}>\r\n          Cam {cameraId}\r\n          <div style={{\r\n            height: '10px',\r\n            width: '10px',\r\n            backgroundColor: isPreviewActive ? 'green' : 'red',\r\n            borderRadius: '50%',\r\n            display: 'inline-block',\r\n            marginLeft: '5px'\r\n          }}></div>\r\n        </span>\r\n\r\n\r\n\r\n        {/* <div className=\"form-check form-switch fs-5\">\r\n          <input\r\n            className=\"form-check-input\"\r\n            type=\"checkbox\"\r\n            role=\"switch\"\r\n            disabled={!isSwitchActive}\r\n            checked={isPreviewActive}\r\n            onChange={() => handlePreviewToggle(cameraId)}\r\n          />\r\n        </div> */}\r\n\r\n        <div className=\"d-flex justify-content-center\" style={{ marginLeft: '30px' }}>\r\n          <div className=\"btn-group\">\r\n            <Button variant=\"primary\" onClick={handleModalToggle} disabled={!isPreviewActive || !isSwitchActive || isStreaming}>\r\n              <FontAwesomeIcon icon={faCog} />\r\n            </Button>\r\n            <Button\r\n              variant=\"primary\"\r\n              onClick={() => handleStreamToggle(cameraId)}\r\n              disabled={!isPreviewActive || !isSwitchActive}\r\n              style={{ backgroundColor: isStreaming ? 'orange' : '' }}\r\n            >\r\n              {isStreaming ? 'Stop Stream' : 'Start Stream'}\r\n            </Button>\r\n          </div>\r\n        </div>\r\n\r\n        {1 == 1 && (\r\n          <div className=\"d-flex justify-content-center\" style={{ marginLeft: '30px' }}>\r\n            <div>FPS: {fps.toFixed(2)} | Rx Speed: {(rxSpeed / 1024).toFixed(2)} Mb/s</div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const renderCameraModal = (cameraId) => {\r\n    const { showModalSettings, formValues, comment, isVirtual } = cameras[cameraId];\r\n    const handleCloseModal = () => setCameras(prevCameras => ({\r\n      ...prevCameras,\r\n      [cameraId]: {\r\n        ...prevCameras[cameraId],\r\n        showModalSettings: false,\r\n      }\r\n    }));\r\n\r\n    return (\r\n      <Modal show={showModalSettings} onHide={handleCloseModal} key={cameraId}>\r\n        <Modal.Header closeButton>\r\n          <Modal.Title>Cam Server {cameraId} Configuration</Modal.Title>\r\n        </Modal.Header>\r\n        <Modal.Body>\r\n          <Form>\r\n            <Form.Group className=\"mb-3\">\r\n              <Form.Label>Camera ID</Form.Label>\r\n              <Form.Select name=\"camId\" onChange={(e) => handleInputChange(e, cameraId)} value={formValues.camId}>\r\n                <option value=\"\">Select Option</option>\r\n                {allCameras.map((camera, index) => (\r\n                  <option key={index} value={camera.camera_id}>\r\n                    {camera.camera_id}\r\n                  </option>\r\n                ))}\r\n              </Form.Select>\r\n              <Form.Text className=\"text-muted\">\r\n                {comment}\r\n              </Form.Text>\r\n            </Form.Group>\r\n            {isVirtual && (\r\n              <Form.Group className=\"mb-3\">\r\n                <Form.Label>Folder Path</Form.Label>\r\n                <Form.Control name=\"folderPath\" placeholder=\"Enter folder path\" onChange={(e) => handleInputChange(e, cameraId)} value={formValues.folderPath} />\r\n              </Form.Group>\r\n            )}\r\n            <Form.Group className=\"mb-3\">\r\n              <Form.Label>Target Streaming FPS</Form.Label>\r\n              <Form.Control name=\"targetFPS\" type=\"number\" placeholder=\"Enter FPS\" onChange={(e) => handleInputChange(e, cameraId)} value={formValues.targetFPS} />\r\n            </Form.Group>\r\n            <Form.Group className=\"mb-3\">\r\n              <Form.Label>Exposure Time (ms)</Form.Label>\r\n              <Form.Control\r\n                name=\"exposureTime\"\r\n                type=\"number\"\r\n                step=\"0.01\"\r\n                placeholder=\"Enter exposure time in ms\"\r\n                onChange={(e) => handleInputChange(e, cameraId)}\r\n                value={formValues.exposureTime}\r\n              />\r\n            </Form.Group>\r\n\r\n            <Form.Group className=\"mb-3\">\r\n              <Form.Label>Gain</Form.Label>\r\n              <Form.Control\r\n                name=\"gain\"\r\n                type=\"number\"\r\n                step=\"0.01\"\r\n                placeholder=\"Enter gain\"\r\n                onChange={(e) => handleInputChange(e, cameraId)}\r\n                value={formValues.gain}\r\n              />\r\n            </Form.Group>\r\n\r\n\r\n            <Form.Group className=\"mb-3\">\r\n              <Form.Label>Image Format</Form.Label>\r\n              <Form.Select name=\"imageFormat\" onChange={(e) => handleInputChange(e, cameraId)} value={formValues.imageFormat}>\r\n                <option value=\"compressed\">Compressed</option>\r\n                <option value=\"original\">Original</option>\r\n              </Form.Select>\r\n            </Form.Group>\r\n          </Form>\r\n        </Modal.Body>\r\n      </Modal>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-3\">\r\n      <div className=\"d-flex flex-row justify-content-between\">\r\n        {[1, 2].map(cameraId => renderCameraControls(cameraId))}\r\n      </div>\r\n      {/* <div className=\"mt-3\">\r\n        <Form.Range \r\n          min={500} \r\n          max={5000} \r\n          step={100} \r\n          value={maxWidth} \r\n        \r\n        />\r\n        <span className=\"ms-2\">Zoom:</span>\r\n      </div> */}\r\n\r\n      <div style={{\r\n        display: 'grid',\r\n        width: '100%',\r\n        height: '100%',\r\n        marginTop: '20px',\r\n        justifyContent: 'center',\r\n        alignItems: 'center',\r\n        position: 'relative',\r\n        placeItems: 'center'\r\n      }}>\r\n        <canvas\r\n          ref={canvasRefs[1]}\r\n          style={{\r\n            gridArea: '1 / 1 / 2 / 2',\r\n            opacity: 1.0,\r\n            zIndex: 1,\r\n            backgroundColor: 'transparent',\r\n          }}\r\n        />\r\n        <canvas\r\n          ref={canvasRefs[2]}\r\n          style={{\r\n            gridArea: '1 / 1 / 2 / 2',\r\n            opacity: 0.5,\r\n            zIndex: 2,\r\n            backgroundColor: 'transparent',\r\n          }}\r\n        />\r\n\r\n        <canvas\r\n          ref={canvasTrackRef}\r\n          style={{\r\n            gridArea: '1 / 1 / 2 / 2',\r\n            opacity: 1.0,\r\n            zIndex: 3,\r\n            backgroundColor: 'transparent',\r\n\r\n\r\n          }}\r\n        />\r\n\r\n        <canvas\r\n          ref={canvasHologramRef}\r\n          style={{\r\n            gridArea: '1 / 1 / 2 / 2',\r\n            opacity: 1.0,\r\n            zIndex: 4,\r\n            backgroundColor: 'transparent'\r\n\r\n          }}\r\n        />\r\n      </div>\r\n\r\n      {[1, 2].map(cameraId => renderCameraModal(cameraId))}\r\n\r\n      <ToastContainer />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default CameraPreview;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}